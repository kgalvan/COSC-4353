package gui;

import mastermind.MasterMind;

import javax.swing.*;
import javax.swing.border.LineBorder;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;


public class GUI {

    public static void main(String[] args)
    {
        init();
    }
    static MasterMind mastermind;
    private static void init()
    {
        ColorBox[] arrayOfColorBoxes = new ColorBox[6];
        mastermind = new MasterMind();
        Font sysMessageFont = new Font(Font.SANS_SERIF, Font.PLAIN, 20);
        Font attemptFont = new Font(Font.SANS_SERIF, Font.PLAIN, 30);
        Font buttonFont = new Font(Font.SANS_SERIF, Font.PLAIN, 20);
        JFrame frame = new JFrame("MasterMind");
        frame.getContentPane().setBackground(Color.decode("#FAFAFA"));
        frame.setLayout(null);
        JButton submitButton = new JButton("Submit");
        JButton forfeitButton = new JButton("Forfeit");
        ColorBox firstBox = new ColorBox();
        ColorBox secondBox = new ColorBox();
        ColorBox thirdBox = new ColorBox();
        ColorBox fourthBox = new ColorBox();
        ColorBox fifthBox = new ColorBox();
        ColorBox sixthBox = new ColorBox();
        arrayOfColorBoxes[0] = firstBox;
        arrayOfColorBoxes[1] = secondBox;
        arrayOfColorBoxes[2] = thirdBox;
        arrayOfColorBoxes[3] = fourthBox;
        arrayOfColorBoxes[4] = fifthBox;
        arrayOfColorBoxes[5] = sixthBox;
        JTextField numAttemptsLeft = new JTextField("Attempts Left: " + mastermind.getAttemptsLeft());
        JTextField systemMessage = new JTextField("Welcome! Click the squares to cycle through your guesses");
        numAttemptsLeft.setEditable(false);
        systemMessage.setEditable(false);

        numAttemptsLeft.setFont(attemptFont);
        systemMessage.setFont(sysMessageFont);
        forfeitButton.setFont(buttonFont);
        submitButton.setFont(buttonFont);

        frame.setBounds(200,200,800,800);

        forfeitButton.setBounds(200,600,100,100);
        submitButton.setBounds(500,600,100,100);

        forfeitButton.setBackground(Color.decode("#FAFAFA"));
        forfeitButton.setBorder(null);
        forfeitButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
               systemMessage.setText("Welcome! Click the squares to cycle through your guesses");
               for (int i = 0; i < 6; i++) {
                   arrayOfColorBoxes[i].setBackground(Color.WHITE);
               }
               forfeitButton.setText("Forfeit");
               mastermind = new MasterMind();
               numAttemptsLeft.setText("Attempts Left: " + mastermind.getAttemptsLeft());

            }
        });
        submitButton.addActionListener(new ActionListener() {
            GUI gui = new GUI();
            public void actionPerformed(ActionEvent ae){
                if (mastermind.getGameStatus() == MasterMind.GameStatus.WON || mastermind.getGameStatus() == MasterMind.GameStatus.LOST) {
                    systemMessage.setText("Game Over");
                    forfeitButton.setText("Play Again");
                }
                else {
                    Map<MasterMind.Response, Long> response;
                    List<Color> userGuess = gui.getUserGuess(firstBox, secondBox, thirdBox, fourthBox, fifthBox, sixthBox);
                    response = mastermind.guess(userGuess);
                    List<Color> responseColors = new ArrayList<Color>();
                    responseColors = gui.setResponse(response);

                    for (int i = responseColors.size(); i < 6; i++) {
                        responseColors.add(Color.WHITE);
                    }
                    firstBox.setBackground(responseColors.get(0));
                    secondBox.setBackground(responseColors.get(1));
                    thirdBox.setBackground(responseColors.get(2));
                    fourthBox.setBackground(responseColors.get(3));
                    fifthBox.setBackground(responseColors.get(4));
                    sixthBox.setBackground(responseColors.get(5));
                    if (mastermind.getGameStatus() == MasterMind.GameStatus.WON) {
                        systemMessage.setText("Congratulations! You won!");
                    } else if (mastermind.getGameStatus() == MasterMind.GameStatus.LOST) {
                        systemMessage.setText("Sorry. You lost.");
                    } else if (mastermind.getGameStatus() == MasterMind.GameStatus.IN_PROGRESS) {
                        systemMessage.setText("Keep trying!");
                    }
                    numAttemptsLeft.setText("Attempts Left: " + Integer.toString(mastermind.getAttemptsLeft()));
                }
            }
        });
        submitButton.setBackground(Color.decode("#FAFAFA"));
        submitButton.setBorder(null);
        firstBox.setBounds(90,200,100,300);
        firstBox.setBorder(new LineBorder(Color.BLACK));
        firstBox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
                firstBox.changeColor();
            }
        });
        secondBox.setBounds(190,200,100,300);
        secondBox.setBorder(new LineBorder(Color.BLACK));
        secondBox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
                secondBox.changeColor();
            }
        });
        thirdBox.setBounds(290,200,100,300);
        thirdBox.setBorder(new LineBorder(Color.BLACK));
        thirdBox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
                thirdBox.changeColor();
            }
        });
        fourthBox.setBounds(390,200,100,300);
        fourthBox.setBorder(new LineBorder(Color.BLACK));
        fourthBox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
                fourthBox.changeColor();
            }
        });
        fifthBox.setBounds(490,200,100,300);
        fifthBox.setBorder(new LineBorder(Color.BLACK));
        fifthBox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
                fifthBox.changeColor();
            }
        });
        sixthBox.setBounds(590,200,100,300);
        sixthBox.setBorder(new LineBorder(Color.BLACK));
        sixthBox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent ae){
                sixthBox.changeColor();
            }
        });

        numAttemptsLeft.setBounds(500,0,300,100);
        systemMessage.setBounds(90, 100, 800, 100);
        numAttemptsLeft.setBorder(null);
        systemMessage.setBorder(null);
        numAttemptsLeft.setBackground(null);
        systemMessage.setBackground(null);

        frame.add(numAttemptsLeft);
        frame.add(systemMessage);
        frame.add(firstBox);
        frame.add(secondBox);
        frame.add(thirdBox);
        frame.add(fourthBox);
        frame.add(fifthBox);
        frame.add(sixthBox);
        frame.add(submitButton);
        frame.add(forfeitButton);

        frame.setVisible(true);
        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
    }

    public List<Color> getUserGuess (ColorBox box1, ColorBox box2, ColorBox box3, ColorBox box4, ColorBox box5, ColorBox box6) {
        List<Color> userGuess = new ArrayList<Color>();
        userGuess.add(box1.getBackground());
        userGuess.add(box2.getBackground());
        userGuess.add(box3.getBackground());
        userGuess.add(box4.getBackground());
        userGuess.add(box5.getBackground());
        userGuess.add(box6.getBackground());
        return userGuess;

    }

    public List<Color> setResponse (Map<MasterMind.Response, Long> response) {
        
        List<Color> colorList = new ArrayList<>();
        for (int i = 0; i < (int) (long)response.get(MasterMind.Response.POSITIONAL_MATCH); i++) {
            colorList.add(Color.BLACK);
        }
        for (int i = 0; i < (int) (long)response.get(MasterMind.Response.MATCH); i++) {
            colorList.add(Color.GRAY);
        }

        return colorList;
    }


}
class ColorBox extends JButton
{
    Color color;
    public ColorBox() {
        super();
        color = Color.WHITE;
        setBackground(color);
    }

    public ColorBox(Color currentColor) {
        super();
        color = currentColor;
        setBackground(color);
    }

    public Color[] getAvailableColors() {
        Color[]allColorArray = new Color[]{Color.RED,Color.BLUE,Color.CYAN,Color.YELLOW,Color.GREEN,Color.ORANGE,Color.PINK,Color.MAGENTA,Color.BLACK,Color.GRAY};
        return allColorArray;
    }

    public void changeColor() {
        Color[] availableColors = getAvailableColors();

        if(color.equals(Color.WHITE))
            color = Color.RED;

        else if(color.equals(Color.GRAY)) {
            color = Color.RED;
        }

        else{
            for(int x = 0; x <10; x++) {
                if (color.equals(availableColors[x])) {
                    color = availableColors[x+1];
                    break;
                }
            }

        }
        this.setBackground(color);
    }
}
